<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FairBid - 경매 등록</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <h1>FairBid</h1>
            <nav class="nav-links">
                <a href="/">경매 상세</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2 class="card-title">경매 등록</h2>

            <!-- 결과 메시지 -->
            <div id="message" class="alert" style="display: none;"></div>

            <form id="auction-form" onsubmit="return handleSubmit(event)">
                <!-- 제목 -->
                <div class="form-group">
                    <label for="title">제목 *</label>
                    <input type="text" id="title" name="title" required placeholder="경매 상품 제목">
                </div>

                <!-- 설명 -->
                <div class="form-group">
                    <label for="description">설명</label>
                    <textarea id="description" name="description" placeholder="상품에 대한 상세 설명"></textarea>
                </div>

                <!-- 카테고리 -->
                <div class="form-group">
                    <label for="category">카테고리 *</label>
                    <select id="category" name="category" required>
                        <option value="">선택해주세요</option>
                        <option value="ELECTRONICS">전자기기</option>
                        <option value="FASHION">패션/의류</option>
                        <option value="HOME">가구/생활</option>
                        <option value="SPORTS">스포츠/레저</option>
                        <option value="HOBBY">취미/수집</option>
                        <option value="OTHER">기타</option>
                    </select>
                </div>

                <!-- 시작가 -->
                <div class="form-group">
                    <label for="startPrice">시작가 *</label>
                    <input type="number" id="startPrice" name="startPrice" required min="1" placeholder="1000">
                    <p class="form-hint">경매 시작 가격을 입력하세요.</p>
                </div>

                <!-- 즉시구매가 -->
                <div class="form-group">
                    <label for="instantBuyPrice">즉시구매가 (선택)</label>
                    <input type="number" id="instantBuyPrice" name="instantBuyPrice" min="1" placeholder="100000">
                    <p class="form-hint">입력하지 않으면 즉시구매 기능이 비활성화됩니다. 시작가보다 높아야 합니다.</p>
                </div>

                <!-- 경매 기간 -->
                <div class="form-group">
                    <label for="duration">경매 기간 *</label>
                    <select id="duration" name="duration" required>
                        <option value="">선택해주세요</option>
                        <option value="HOURS_24">24시간</option>
                        <option value="HOURS_48">48시간</option>
                    </select>
                </div>

                <!-- 제출 버튼 -->
                <div class="form-group">
                    <button type="submit" id="submit-btn" class="btn btn-primary" style="width: 100%;">
                        경매 등록
                    </button>
                </div>
            </form>
        </div>

        <!-- 등록 성공 시 표시 -->
        <div id="success-card" class="card" style="display: none;">
            <h2 class="card-title">경매 등록 완료!</h2>
            <p>경매가 성공적으로 등록되었습니다.</p>
            <div class="price-info" style="margin: 20px 0;">
                <div class="price-item">
                    <div class="price-label">경매 ID</div>
                    <div id="created-auction-id" class="value">-</div>
                </div>
                <div class="price-item">
                    <div class="price-label">시작가</div>
                    <div id="created-start-price" class="value">-</div>
                </div>
            </div>
            <a id="view-auction-link" href="#" class="btn btn-primary" style="display: inline-block; text-decoration: none;">
                경매 상세 보기
            </a>
        </div>
    </main>

    <script src="/js/api.js"></script>
    <script>
        // 폼 제출 처리
        async function handleSubmit(event) {
            event.preventDefault();

            const form = document.getElementById('auction-form');
            const submitBtn = document.getElementById('submit-btn');

            // 버튼 비활성화
            submitBtn.disabled = true;
            submitBtn.textContent = '등록 중...';

            // 폼 데이터 수집
            const formData = {
                title: form.title.value.trim(),
                description: form.description.value.trim() || null,
                category: form.category.value,
                startPrice: parseInt(form.startPrice.value),
                instantBuyPrice: form.instantBuyPrice.value ? parseInt(form.instantBuyPrice.value) : null,
                duration: form.duration.value,
                imageUrls: []
            };

            try {
                // API 호출
                const auction = await createAuction(formData);

                // 성공 처리
                showSuccess(auction);

            } catch (error) {
                showMessage(error.message, 'error');
                submitBtn.disabled = false;
                submitBtn.textContent = '경매 등록';
            }
        }

        // 성공 표시
        function showSuccess(auction) {
            // 폼 숨기기
            document.getElementById('auction-form').style.display = 'none';
            document.getElementById('message').style.display = 'none';

            // 성공 카드 표시
            const successCard = document.getElementById('success-card');
            successCard.style.display = 'block';

            document.getElementById('created-auction-id').textContent = auction.id;
            document.getElementById('created-start-price').textContent = formatPrice(auction.startPrice);
            document.getElementById('view-auction-link').href = '/?id=' + auction.id;
        }

        // 메시지 표시
        function showMessage(message, type) {
            const el = document.getElementById('message');
            el.textContent = message;
            el.className = 'alert alert-' + type;
            el.style.display = 'block';
        }

        // 즉시구매가 검증
        function validateInstantBuyPrice() {
            const startPrice = parseInt(document.getElementById('startPrice').value) || 0;
            const instantBuyPriceInput = document.getElementById('instantBuyPrice');
            const instantBuyPrice = parseInt(instantBuyPriceInput.value) || 0;

            if (instantBuyPrice > 0 && instantBuyPrice <= startPrice) {
                instantBuyPriceInput.setCustomValidity('즉시구매가는 시작가보다 높아야 합니다.');
            } else {
                instantBuyPriceInput.setCustomValidity('');
            }
        }

        // 즉시구매가 입력 시 검증
        document.getElementById('instantBuyPrice').addEventListener('input', validateInstantBuyPrice);

        // 시작가 변경 시 즉시구매가 재검증
        document.getElementById('startPrice').addEventListener('input', validateInstantBuyPrice);
    </script>
</body>
</html>
