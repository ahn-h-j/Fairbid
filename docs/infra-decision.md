# 클라우드 인프라 선택 트레이드오프 분석

> 이 문서는 FairBid 프로젝트의 클라우드 배포 환경(EC2 vs ECS vs EKS) 선택 과정에서의 트레이드오프를 기록합니다.

---

## 1. 프로젝트 컨텍스트 및 제약 조건

### 1.1 프로젝트 목적
- **용도**: 취업 포트폴리오 프로젝트
- **주요 목표**: 데모 시연 + 부하테스트 결과 문서화
- **어필 포인트**: 풀스택 종합 역량 (백엔드 + 인프라 + 실시간 시스템)

### 1.2 제약 조건

| 항목 | 제약 |
|------|------|
| **월 예산** | 5만원 미만 (~$35) |
| **AWS 프리티어** | 소진됨 |
| **학습 가용 시간** | 1-2주 내 배포 필요 |
| **인프라 경험** | 전무 (백엔드 개발에 집중) |
| **CI/CD 경험** | 이론 수준만 학습 |

### 1.3 기술적 요구사항

| 항목 | 요구사항 |
|------|----------|
| **부하 목표** | 500~1,000명 동시 WebSocket 접속 |
| **운영 패턴** | 면접 시에만 일시 가동 (예상 10회 이상) |
| **모니터링** | Prometheus + Grafana 대시보드 |
| **DB/캐시** | Docker Compose 통합 → 스케일링 시 분리 |
| **HTTPS** | HTTP만 사용 (포트폴리오 목적) |
| **IaC** | 사용 안 함 (수동 구성) |

### 1.4 아키텍처 진화 계획

```
모놀리식 → Sticky Session → Redis Pub/Sub
    │           │                │
    │           │                └── 인스턴스 간 메시지 동기화
    │           └── ALB 기반 세션 고정
    └── 단일 인스턴스 Docker Compose
```

---

## 2. 후보 기술 분석

### 2.1 Amazon EKS (Elastic Kubernetes Service)

#### 비용 분석
```
EKS 클러스터 비용: $0.10/시간 × 24시간 × 30일 = $72/월 (약 10만원)
워커 노드 (t3.medium × 2): $0.0416/시간 × 24 × 30 × 2 = $60/월
────────────────────────────────────────────────────────────────
총 예상 비용: 최소 $132/월 (약 18만원)
```

**결론**: 클러스터 비용만으로 월 예산($35)의 3배 초과. **비용 제약으로 불가능**

#### 학습 곡선
- Pod, Service, Deployment, ConfigMap, Secret 개념 학습 필요
- Ingress Controller, Service Mesh 등 네트워킹 이해 필요
- kubectl CLI 숙달 필요
- **1-2주로는 기본 개념 이해도 어려움**

#### 면접 대응 리스크
- "왜 EKS를 선택했나요?" → 명확한 근거 제시 어려움
- 작은 규모의 프로젝트에 K8s는 **오버엔지니어링** 비판 가능
- K8s 내부 동작 질문 시 대응 불가 (경험 부족)

#### 장점 (참고용)
- K8s 경험 어필 가능
- 풍부한 생태계 및 커뮤니티
- 대규모 트래픽 처리에 적합

#### EKS 평가 요약

| 평가 항목 | 점수 | 사유 |
|-----------|------|------|
| 비용 적합성 | ❌ | 예산의 5배 이상 |
| 학습 가능성 | ❌ | 1-2주로 불가능 |
| 면접 대응 | ⚠️ | 오버엔지니어링 비판 위험 |
| 스케일링 용이성 | ✅ | K8s 네이티브 기능 |

---

### 2.2 Amazon ECS (Elastic Container Service) with Fargate

#### 비용 분석
```
Fargate 가격 (서울 리전):
- vCPU: $0.04048/시간
- 메모리: $0.004445/GB/시간

App 서버 (0.5 vCPU, 1GB):
= ($0.04048 × 0.5) + ($0.004445 × 1) = $0.0247/시간

면접 시연 (3시간 × 10회): $0.0247 × 30 = $0.74

+ MySQL 컨테이너 (0.5 vCPU, 1GB): $0.74
+ Redis 컨테이너 (0.25 vCPU, 0.5GB): $0.37
+ Prometheus (0.25 vCPU, 0.5GB): $0.37
+ Grafana (0.25 vCPU, 0.5GB): $0.37
────────────────────────────────────────────────────────────────
총 예상 비용: $2.59 (시연만 할 경우)
```

**결론**: 시연만 할 경우 예산 내 가능. 단, **개발/테스트 시 추가 비용 발생**

#### 학습 곡선
- Task Definition, Service, Cluster 개념 학습 필요
- ALB 연동, 서비스 디스커버리 이해 필요
- AWS Console 또는 AWS CLI 숙달 필요
- **1-2주 내 가능하지만 빠듯함**

#### 주요 고려사항

**장점**:
- 서버 관리 불필요 (Fargate)
- Docker Compose에서 전환 비교적 용이
- AWS 네이티브로 안정적
- 컨테이너 오케스트레이션 경험 어필 가능

**단점**:
- EC2 대비 시간당 비용 높음
- K8s 사용 회사에는 어필력 제한
- 개발/디버깅 시 로컬 환경과 차이 큼

#### ECS 평가 요약

| 평가 항목 | 점수 | 사유 |
|-----------|------|------|
| 비용 적합성 | ⚠️ | 시연만 하면 가능, 개발 시 주의 |
| 학습 가능성 | ⚠️ | 1-2주 빠듯함 |
| 면접 대응 | ✅ | 컨테이너 경험 어필 가능 |
| 스케일링 용이성 | ✅ | 서비스 Auto Scaling 용이 |

---

### 2.3 Amazon EC2 (Elastic Compute Cloud)

#### 비용 분석
```
EC2 인스턴스 가격 (서울 리전, On-Demand):
- t3.micro: $0.0104/시간
- t3.small: $0.0208/시간
- t3.medium: $0.0416/시간

시나리오별 비용:

[1단계: 모놀리식]
t3.small × 1 (App + DB + Redis)
면접 시연 (3시간 × 10회): $0.0208 × 30 = $0.62

[2단계: DB 분리 + 스케일 아웃]
t3.small × 3 (App × 2 + DB/Redis × 1) + ALB ($0.0225/시간)
면접 시연: ($0.0208 × 3 + $0.0225) × 30 = $2.55

[3단계: Auto Scaling 테스트]
t3.small × 4 (App × 3 + DB/Redis × 1) + ALB
면접 시연: ($0.0208 × 4 + $0.0225) × 30 = $3.17
────────────────────────────────────────────────────────────────
총 예상 비용: ~$3-5 (시연 기준)
```

**결론**: **가장 비용 효율적**. 예산 내에서 다양한 실험 가능

#### 학습 곡선
- SSH 접속, 보안 그룹 설정
- Docker 설치, docker-compose 실행
- 로컬 개발 환경과 유사하여 진입 장벽 낮음
- **1-2주 내 충분히 가능**

#### 주요 고려사항

**장점**:
- 가장 저렴한 비용
- 학습 곡선 가장 완만
- 로컬 환경과 유사 (Docker Compose 그대로 사용)
- 점진적 복잡도 증가 가능
- "비용 대비 효율"이라는 명확한 선택 근거

**단점**:
- 서버 관리 부담 (OS 패치 등)
- 컨테이너 오케스트레이션 경험 어필 제한
- 수동 작업이 많음 (AMI 생성, Launch Template 등)

#### EC2 평가 요약

| 평가 항목 | 점수 | 사유 |
|-----------|------|------|
| 비용 적합성 | ✅ | 가장 저렴 |
| 학습 가능성 | ✅ | 1-2주 충분 |
| 면접 대응 | ⚠️ | 오케스트레이션 어필 제한 |
| 스케일링 용이성 | ⚠️ | 수동/반자동 (ASG 설정 필요) |

---

## 3. 종합 비교

### 3.1 비용 비교 (면접 시연 10회, 회당 3시간 기준)

| 서비스 | 시연 비용 | 월 상시 운영 | 예산 적합성 |
|--------|-----------|--------------|-------------|
| **EKS** | $15+ | $130+ | ❌ 불가능 |
| **ECS (Fargate)** | $2.6 | $60+ | ⚠️ 시연만 가능 |
| **EC2** | $3.2 | $15-30 | ✅ 적합 |

### 3.2 학습 곡선 비교

```
난이도 ──────────────────────────────────────────────────▶
     낮음                                              높음
      │                                                  │
      ▼                                                  ▼
    EC2 ─────────── ECS ──────────────────────────── EKS
    (1주)          (2주)                            (1-2개월)
```

### 3.3 포트폴리오 어필 포인트 비교

| 어필 포인트 | EC2 | ECS | EKS |
|-------------|-----|-----|-----|
| 비용 최적화 의사결정 | ✅ | ⚠️ | ❌ |
| 컨테이너 오케스트레이션 | ❌ | ✅ | ✅ |
| 점진적 아키텍처 진화 | ✅ | ⚠️ | ❌ |
| 실무 K8s 경험 | ❌ | ❌ | ✅ |
| 스케일링 자동화 | ✅ (ASG) | ✅ | ✅ |
| 장애 복구 시연 | ⚠️ | ✅ | ✅ |

---

## 4. 의사결정

### 4.1 결정: EC2 기반 점진적 진화 전략

**선택 근거**:

1. **비용 제약 충족**: 프리티어 소진 상태에서 월 5만원 미만 유지 가능
2. **학습 시간 적합**: 1-2주 내 배포 가능한 유일한 옵션
3. **점진적 복잡도 증가**: 모놀리식 → 스케일 아웃 → HA로 진화 과정 문서화 가능
4. **명확한 기술 선택 근거**: "비용 효율성"과 "점진적 성장"이라는 스토리텔링

### 4.2 제외 사유

| 서비스 | 제외 사유 |
|--------|----------|
| **EKS** | 클러스터 비용($72/월)만으로 예산 초과, 학습 시간 부족 |
| **ECS** | 시연만으로는 가능하나 개발/테스트 시 비용 부담, 학습 곡선 빠듯함 |

### 4.3 EKS/ECS를 선택하지 않은 이유 (면접 대응용)

> "프로젝트 규모와 팀 구성(1인 개발)을 고려했을 때, EKS는 오버엔지니어링이라고 판단했습니다.
> K8s의 강점인 자동 복구, 롤링 업데이트, 서비스 메시 등은 대규모 MSA 환경에서 빛을 발하지만,
> 단일 애플리케이션에서는 오히려 운영 복잡도만 증가시킵니다.
>
> 대신 EC2 Auto Scaling Group으로 스케일 아웃을 구현하고,
> 추후 서비스가 성장하면 ECS나 EKS로 마이그레이션하는 점진적 접근을 선택했습니다.
> 이는 스타트업에서 흔히 사용하는 '적정 기술' 전략입니다."

---

## 5. 구현 로드맵

### Phase 1: 모놀리식 배포 (1주차)

```
┌─────────────────────────────────────┐
│           EC2 (t3.small)            │
│  ┌─────────────────────────────┐   │
│  │      Docker Compose         │   │
│  │  ┌─────┐ ┌─────┐ ┌───────┐ │   │
│  │  │ App │ │MySQL│ │ Redis │ │   │
│  │  └─────┘ └─────┘ └───────┘ │   │
│  └─────────────────────────────┘   │
└─────────────────────────────────────┘
```

**목표**:
- EC2 인스턴스 생성 및 Docker 환경 구성
- 기존 docker-compose.yml로 배포
- 단일 인스턴스에서 부하테스트 (기준점 측정)

**산출물**:
- 단일 인스턴스 한계점 측정 결과 (동시 접속 N명에서 응답 지연 발생)

### Phase 2: DB 분리 + 스케일 아웃 (2주차)

```
                    ┌─────────────┐
                    │     ALB     │
                    │  (Sticky)   │
                    └──────┬──────┘
                           │
            ┌──────────────┼──────────────┐
            ▼              ▼              ▼
     ┌───────────┐  ┌───────────┐  ┌───────────┐
     │  App #1   │  │  App #2   │  │  App #3   │
     │ (EC2)     │  │ (EC2)     │  │ (EC2)     │
     └─────┬─────┘  └─────┬─────┘  └─────┬─────┘
           │              │              │
           └──────────────┼──────────────┘
                          ▼
                   ┌─────────────┐
                   │   DB/Cache  │
                   │   (EC2)     │
                   │ MySQL+Redis │
                   └─────────────┘
```

**목표**:
- MySQL/Redis를 별도 EC2로 분리
- ALB + Sticky Session 구성
- App 서버 수평 확장 (2-3개)
- 스케일 아웃 효과 측정

**산출물**:
- Sticky Session 기반 WebSocket 연결 분산 검증
- 스케일 아웃 전/후 성능 비교 데이터

### Phase 3: Auto Scaling + HA (3주차, 선택)

```
                    ┌─────────────┐
                    │     ALB     │
                    └──────┬──────┘
                           │
     ┌─────────────────────┼─────────────────────┐
     │                     │                     │
     ▼                     ▼                     ▼
┌─────────┐          ┌─────────┐          ┌─────────┐
│   AZ-a  │          │   AZ-b  │          │   AZ-c  │
│ ┌─────┐ │          │ ┌─────┐ │          │ ┌─────┐ │
│ │App 1│ │          │ │App 2│ │          │ │App 3│ │
│ └─────┘ │          │ └─────┘ │          │ └─────┘ │
└─────────┘          └─────────┘          └─────────┘
                           │
              ┌────────────┴────────────┐
              ▼                         ▼
       ┌───────────┐             ┌───────────┐
       │  MySQL    │             │   Redis   │
       │ (Primary) │             │ (Primary) │
       └───────────┘             └───────────┘
```

**목표**:
- Auto Scaling Group 설정 (CPU 기반 스케일링 정책)
- 다중 AZ 배포로 가용성 확보
- 장애 시뮬레이션 및 복구 테스트

**산출물**:
- Auto Scaling 동작 로그 및 Grafana 대시보드 캡처
- 장애 복구 시나리오 문서

### Phase 4: Redis Pub/Sub 적용 (4주차, 선택)

**목표**:
- Sticky Session 제거
- Redis Pub/Sub으로 인스턴스 간 WebSocket 메시지 동기화
- 진정한 Stateless 아키텍처 달성

**산출물**:
- Sticky Session vs Pub/Sub 성능 비교
- 아키텍처 진화 과정 문서

---

## 6. 부하테스트 계획

### 6.1 테스트 도구
- **k6**: HTTP + WebSocket 부하테스트 지원

### 6.2 테스트 시나리오

```javascript
// k6 테스트 시나리오 예시
export const options = {
  stages: [
    { duration: '1m', target: 100 },   // Ramp-up
    { duration: '3m', target: 500 },   // Hold at 500
    { duration: '2m', target: 1000 },  // Scale to 1000
    { duration: '3m', target: 1000 },  // Hold at 1000
    { duration: '1m', target: 0 },     // Ramp-down
  ],
};
```

### 6.3 측정 메트릭
- WebSocket 연결 성공률
- 메시지 지연 시간 (p50, p95, p99)
- 동시 접속자 수 대비 CPU/메모리 사용률
- 스케일 아웃 트리거 시점

---

## 7. 모니터링 구성

### 7.1 Prometheus + Grafana 스택

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  App Server │────▶│ Prometheus  │────▶│   Grafana   │
│ (micrometer)│     │             │     │             │
└─────────────┘     └─────────────┘     └─────────────┘
```

### 7.2 수집 메트릭
- JVM 메트릭 (Heap, GC, Thread)
- HTTP 요청 메트릭 (요청 수, 응답 시간, 에러율)
- WebSocket 메트릭 (연결 수, 메시지 처리량)
- 비즈니스 메트릭 (활성 경매 수, 입찰 수)

### 7.3 대시보드 구성
- 시스템 리소스 현황
- 애플리케이션 성능 현황
- 부하테스트 결과 시각화

---

## 8. 예상 질문 및 답변 (면접 대비)

### Q1: "왜 EKS 대신 EC2를 선택했나요?"

> A: "프로젝트 규모와 운영 복잡도를 고려한 결정입니다. EKS는 월 $70 이상의 클러스터 비용이 발생하고,
> K8s의 강점인 자동 복구, 서비스 메시 등은 MSA 환경에서 의미가 있습니다.
> 단일 애플리케이션에서는 EC2 Auto Scaling Group으로 충분히 스케일 아웃이 가능하고,
> 비용 대비 효율이 훨씬 좋습니다. 실제 서비스 성장 시 ECS/EKS로 마이그레이션하는
> 점진적 접근이 스타트업에서 흔히 사용하는 전략입니다."

### Q2: "WebSocket 스케일 아웃 시 세션 관리는 어떻게 했나요?"

> A: "두 가지 전략을 순차적으로 적용했습니다.
> 1단계로 ALB Sticky Session을 사용해 동일 사용자를 같은 인스턴스로 라우팅했고,
> 2단계로 Redis Pub/Sub을 적용해 인스턴스 간 메시지 동기화를 구현했습니다.
> Sticky Session은 간단하지만 부하 분산이 불균형해질 수 있고,
> Pub/Sub은 진정한 Stateless를 달성하지만 Redis 의존성이 생깁니다.
> 트레이드오프를 경험하고 문서화한 것이 이 프로젝트의 핵심 가치입니다."

### Q3: "500명 동시 접속 테스트 결과는 어떻게 되나요?"

> A: "단일 t3.small 인스턴스에서는 약 200명 동시 접속 시 응답 지연이 발생했습니다.
> 3대로 스케일 아웃 후 500명까지 p99 응답시간 100ms 이내를 유지했고,
> 1000명에서는 Auto Scaling이 트리거되어 5대까지 확장되었습니다.
> 이 과정을 Grafana 대시보드로 시각화해서 문서에 포함했습니다."

### Q4: "ECS나 EKS로 마이그레이션한다면 어떤 점이 달라지나요?"

> A: "현재 Docker Compose 기반이라 ECS로의 전환은 비교적 수월합니다.
> Task Definition으로 컨테이너 스펙을 정의하고, Service로 원하는 수를 유지하면 됩니다.
> EKS는 추가로 Deployment, Service, Ingress 등 K8s 리소스 정의가 필요하고,
> Helm 차트로 패키징하면 재사용성이 높아집니다.
> 다만 팀 규모가 작다면 ECS Fargate가 운영 부담 대비 효율적이라고 생각합니다."

---

## 9. 결론

### 최종 선택: **Amazon EC2 + Auto Scaling Group**

### 선택 근거 요약

| 기준 | EC2 선택 이유 |
|------|---------------|
| **비용** | 프리티어 소진 상태에서 유일하게 예산 내 운영 가능 |
| **학습 곡선** | 1-2주 내 배포 가능한 유일한 옵션 |
| **확장성** | Auto Scaling Group으로 자동 스케일링 구현 가능 |
| **포트폴리오 가치** | "적정 기술 선택"과 "점진적 진화"라는 스토리텔링 가능 |
| **면접 대응** | 명확한 트레이드오프 근거 제시 가능 |

### 핵심 메시지

> "기술 선택은 항상 트레이드오프입니다.
> 최신 기술(K8s)을 사용하는 것보다 **프로젝트 상황에 맞는 적정 기술**을 선택하고,
> 그 근거를 명확히 설명할 수 있는 것이 더 중요합니다."

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| 1.0 | 2025-01-14 | 최초 작성 |
