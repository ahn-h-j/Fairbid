sequenceDiagram
autonumber
actor Buyer as 구매자 (Client)
participant Ctrl as AuctionController
participant UC as GetAuctionUseCase
participant Svc as AuctionQueryService
participant Cache as RedisAuctionCacheAdapter
participant Port as AuctionRepository (Port)
participant Adapter as AuctionPersistenceAdapter
participant Redis as Redis
participant RDB as MySQL

    Buyer->>Ctrl: GET /api/v1/auctions/{id}
    Ctrl->>UC: getAuction(id)
    UC->>Svc: getAuctionDetail(id)

    rect rgb(235, 245, 255)
        Note over Svc, Redis: [Redis 캐시 조회 우선]
        Svc->>Cache: findById(id)
        Cache->>Redis: HGETALL auction:{id}

        alt 캐시 히트
            Redis-->>Cache: 경매 데이터
            Cache-->>Svc: Auction (from cache)
        else 캐시 미스
            Redis-->>Cache: null
            Cache-->>Svc: null
            Svc->>Port: findById(id)
            Port->>Adapter: findById(id)
            Adapter->>RDB: SELECT * FROM auctions WHERE id = ?
            RDB-->>Adapter: AuctionEntity
            Adapter-->>Port: Auction
            Port-->>Svc: Auction

            Note over Svc, Redis: [캐시에 로드]
            Svc->>Cache: saveToCache(auction)
            Cache->>Redis: HSET auction:{id} ...
        end
    end

    rect rgb(240, 248, 255)
        Note over Svc: [응답 데이터 가공]
        Svc->>Svc: 1. 즉시 구매 활성화 여부<br/>(currentPrice < instantBuyPrice * 0.9)
        Svc->>Svc: 2. 다음 입찰 최소 금액<br/>(currentPrice + bidIncrement)
        Svc->>Svc: 3. 수정 가능 여부<br/>(totalBidCount == 0)
        Svc->>Svc: 4. 남은 시간 계산
    end

    Svc-->>UC: AuctionDetailResponse
    UC-->>Ctrl: AuctionDetailResponse
    Ctrl-->>Buyer: 200 OK
